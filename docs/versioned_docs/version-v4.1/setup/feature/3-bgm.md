---
sidebar_position: 3
---
# BGM 機能
(v3.7.0で追加)

あらかじめ`config.json`に設定しておくことで、ユーザーが特定のボイスチャンネルに参加したときに、あらかじめ設定したBGMを、再生するように設定することができます。  

:::info
設定には、JSONファイルを編集できる、最低限の知識が必要です。
:::

## 特長
- 指定されたボイスチャンネルに、ユーザーが参加した際に、あらかじめ設定したBGMを自動的に再生開始できます。
- ボイスチャンネルを離脱した際に、自動的に切断できます。
- BGM再生をどれだけ優先するかを設定できます。
- 通常のキューとは切り離された、BGMキューを使用して再生します。

## 設定方法
設定には、config.jsonに、`bgm`というキーを持つオブジェクトを記述します。  
具体的な設定例は、[サンプルの設定ファイル](https://github.com/mtripg6666tdr/Discord-SimpleMusicBot/blob/master/util/config-with-bgm.json)をご覧ください。  
`bgm`に記述するオブジェクトの内容は、サーバーIDのキーを持つオブジェクトです。ここでは、このオブジェクトに含まれる設定について解説します。 
(カッコ内は、型です)

- `voiceChannelId` (string)  
  BGMを再生するボイスチャンネルのIDです。  

- `allowEditQueue` (boolean)  
  BGM再生中に、ユーザーが通常のキューを編集することを許可します。これを許可すると、ユーザーはBGM再生を終了して、通常のキューから音楽を再生できるようになります。  

  設定値:
  - `true`: 許可します
  - `false`: 禁止します
  
  :::info
  `mode`が`only`モード、もしくは`prior`モードになっていた場合、このオプションは無視されます。
  :::

- `enableQueueLoop` (boolean)  
  BGMキューのキューループを有効にします。これを有効にすると、BGMとして設定されたセットリストの再生が終了した際に、再度同じセットリスト再生します。

  設定値:
  - `true`: ループを有効にします
  - `false`: ループを無効にします

- `items` (string[])  
  BGMとして、セットリストを設定します。  
  設定には、通常通りのURLのほか、ローカルにある音声ファイルも再生できます。その場合、`package.json`がある場所からのパスを指定してください。

  :::info
  例えば、`package.json`と同じディレクトリに再生したい音声ファイル`audio.mp3`がある場合、`./audio.mp3`と指定します。  
  :::

  :::info
  BGMでの音声ファイルはローカルから再生することをお勧めします。
  :::

- `volume` (number)  
  音量設定を行います。

- `mode` ("only"|"prior"|"normal")  
  - `only`モードでは、BGMの再生のみが行われます。この場合、ユーザーが再生したい楽曲をコマンドで再生することは**できません**。
  - `prior`モードでは、BGM再生が優先されます。
    - 通常の再生を行っていた場合に、BGMに設定されたチャンネルにユーザーが参加した場合、自動的にBGMチャンネルに移動し、BGMキューの再生を開始します。
    - BGM再生中に、別のボイスチャンネルから`再生`コマンド等を使用しても、通常のキューでの音楽の再生を開始することはできません。
  - `normal`モードでは、BGMに設定されたチャンネルにユーザーが参加した際、すでに通常の楽曲を再生している場合には、何もしません。

