# キャッシュ
(v4.0.0で追加)

## 概要
ボットが快適に使えるよう、また、ボットが効率よく動作するために、ボットはキャッシュを使用するようになっています。  
ボットのキャッシュの種類には以下の二種類があります。
### メモリキャッシュ
  - メモリに最低限のキャッシュを保存する機能です。
### 永続キャッシュ
  - 上のメモリキャッシュに加え、楽曲の一部の情報や、検索結果などを、`./cache`フォルダに保存するオプションです。

メモリキャッシュは、設定に関わらず行われますが、
永続キャッシュは[`config.json`の設定](../installation/configuration.md#cachelevel-memory--persistent)から、
有効/無効にすることができます。

:::info

永続キャッシュは、ディスクの容量に余裕がある場合、有効にすることをお勧めします。

:::

## キャッシュ管理
ボットの各種キャッシュは、自動的に管理されるようになっており、通常は操作は必要ありません。

:::info

永続キャッシュの最大容量は[`config.json`の設定](../installation/configuration.md#cachelimit-number--undefined)をもとに
管理されるため、永続キャッシュを有効にした際は、この設定を確実に行ってください。

:::

必要に応じて、メモリキャッシュおよび永続キャッシュを、コマンドから削除することができます。
なお、永続キャッシュはコマンドから削除する必要はなく、手動で`./cache`フォルダからキャッシュを消すことも可能です。

### メモリキャッシュの数を確認する
メモリキャッシュの数を確認するには、
```
log basic
```
スラッシュコマンドの場合は、
```
/log content:基本情報
```
を実行します。

- `メモリキャッシュ数`が現在保持されているキャッシュの数、
- `廃棄メモリキャッシュ数`が現在保持されているキャッシュのうち、利用されていなく破棄される予定のキャッシュの個数、
をそれぞれ表しています。

### メモリキャッシュをすべて削除する
- ボットである特定の楽曲の再生がうまくいかなくなった場合
- ボットのメモリ使用量が異常に多い場合
このような場合は、メモリキャッシュを削除することで改善することがあります。  
メモリキャッシュを全て削除するには、管理者が以下のコマンドを実行します。
```
invoke sp;purgememcache
```

### 永続キャッシュの容量を確認する
永続キャッシュの容量を確認するには、
```
log basic
```
スラッシュコマンドの場合は、
```
/log content:基本情報
```
を実行します。

### 永続キャッシュをすべて削除する
永続キャッシュを全て削除するには、管理者が以下のコマンドを実行します。
```
invoke sp;purgediskcache
```
